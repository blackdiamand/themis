---
import Base from "@layouts/base.astro";
import SelectableOptions from "@components/charts/selectable-options.astro";
import HistogramGeneric from "@components/charts/histogram-generic.astro";
import BarCountOverTime from "@components/charts/bar-count-over-time.astro";
import { getPlatforms, getMarkets } from "@lib/api";

// Download data
const platforms = await getPlatforms();
const markets = await getMarkets();
---

<Base title="Market Charts">
  <div class="p-4 m-2 pb-0 mb-0">
    <h1 class="text-4xl font-bold">Market Charts</h1>
    <div class="mt-2">
      What is a market, really? They're similar under the hood - people trade on
      different outcomes at different prices, leading to a consensus probability
      whether that's with a limit order book, an automated market maker, or some
      other mechanism. However, you can see how flexible they are by how the
      different platforms leverage this mechanism.
    </div>
    <div class="mt-2">
      Here, we'll look at some of the specific traits we measure on each market
      to see how they compare across platforms.
    </div>
  </div>

  <div class="p-4 m-2">
    <div class="my-4">
      <h2 class="font-bold text-2xl" id="vary-selection">
        Histograms of Attributes
      </h2>
      <div class="my-2">
        How much trade volume do these markets typically see? How many traders
        participate on markets on each platform? How long are they typically
        open?
      </div>
    </div>
    <SelectableOptions
      options={[
        {
          icon: "mdi:cash",
          description: "Market distribution by trade volume.",
          component: HistogramGeneric,
          props: {
            platforms: platforms,
            plotTitle: "Histogram of Volume",
            axisTitleX: "Volume (USD)",
            items: markets
              .filter((mkt) => mkt.volume_usd && mkt.volume_usd > 0)
              .map((mkt) => ({
                value: mkt.volume_usd || 0,
                platform_name: mkt.platform_name,
              })),
          },
        },
        {
          icon: "mdi:account-multiple",
          description: "Market distribution by number of traders.",
          component: HistogramGeneric,
          props: {
            platforms: platforms,
            plotTitle: "Histogram of Traders",
            axisTitleX: "Trader count",
            items: markets
              .filter((mkt) => mkt.traders_count && mkt.traders_count > 0)
              .map((mkt) => ({
                value: mkt.traders_count || 0,
                platform_name: mkt.platform_name,
              })),
          },
        },
        {
          icon: "mdi:calendar-blank",
          description: "Market distribution by total duration.",
          component: HistogramGeneric,
          props: {
            platforms: platforms,
            plotTitle: "Histogram of Duration",
            axisTitleX: "Duration (days)",
            items: markets.map((mkt) => ({
              value: mkt.duration_days,
              platform_name: mkt.platform_name,
            })),
          },
        },
        {
          icon: "mdi:fountain-pen-tip",
          description: "Market distribution by title length.",
          component: HistogramGeneric,
          props: {
            platforms: platforms,
            plotTitle: "Histogram of Title Length",
            axisTitleX: "Length (chatacters)",
            items: markets.map((mkt) => ({
              value: mkt.title.length,
              platform_name: mkt.platform_name,
            })),
            cutoffMax: 200,
          },
        },
        {
          icon: "mdi:file-document-multiple-outline",
          description: "Market distribution by total description length.",
          component: HistogramGeneric,
          props: {
            platforms: platforms,
            plotTitle: "Histogram of Description Length",
            axisTitleX: "Length (chatacters)",
            items: markets.map((mkt) => ({
              value: mkt.description.length,
              platform_name: mkt.platform_name,
            })),
          },
        },
        {
          icon: "mdi:check-all",
          description: "Market distribution by resolution value.",
          component: HistogramGeneric,
          props: {
            platforms: platforms,
            plotTitle: "Histogram of Resolution Value",
            axisTitleX: "Probability",
            items: markets.map((mkt) => ({
              value: mkt.resolution,
              platform_name: mkt.platform_name,
            })),
            thresholds: 1,
          },
        },
      ]}
    />
  </div>
  <hr class="my-2" />

  <div class="p-4 m-2">
    <div class="my-4">
      <h2 class="font-bold text-2xl" id="vary-selection">Markets over Time</h2>
      <div class="my-2">
        Prediction markets have become more popular over time, but are there
        more markets to meet that increased demand? Have there been any
        particular spikes in market opens/closes?
      </div>
    </div>
    <BarCountOverTime platforms={platforms} markets={markets} />
  </div>
</Base>
